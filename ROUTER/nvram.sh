#!/bin/sh

#LAN_DOMAIN=guoz.ga
PPOE_NAME=057101258602
PPPOE_PASS=08065222
ADMIN_PASS=gjzgqz
WIFI_PASS=asdfqwer
WIFI_STA_SSID=alibaba-guest
DDNS_NAME=311788
DDNS_PASS=e9b28f4e9ccf52fc7c91b2a9e835733b
DDNS_HOST=guoz.ga
DDNS_HOST=guoz.ml

[ -z $1 ] && echo "Usage: $0 <NAME> [SSID]" && exit
[ "${1::1}" != "R" ] && ADMIN_PASS=asdfzxcv

# WIFI
if [ -z $2 ]; then SSID=Router; else SSID=$2; fi
if [ ! -z `nvram get rt_wpa_psk` ]; then
	nvram set rt_ssid=$SSID
	nvram set rt_ssid2=$SSID
	nvram set rt_wpa_psk=$WIFI_PASS
fi
if [ ! -z `nvram get wl_wpa_psk` ]; then
	nvram set wl_ssid=${SSID}5
	nvram set wl_ssid2=${SSID}5
	nvram set wl_wpa_psk=$WIFI_PASS
fi

# WISP
if [ "$1" = "ROUTER" ]; then
	nvram set wl_mode_x=3
	nvram set wl_sta_wisp=1
	nvram set wl_sta_ssid=$WIFI_STA_SSID
	nvram set wl_channel=157
	nvram set wl_sta_auto=1
fi

# LAN
LEN=$((${#1}-1))
lan_ip=${1:$LEN:1}
if [ "$1" = "router" ]; then
	lan_pre=192.168.2
	nvram set dhcp_start=$lan_pre.10
else
	lan_pre=192.168.1
	nvram set dhcp_start=$lan_pre.70
fi
expr $lan_ip "+" 0 &> /dev/null || lan_ip=1
nvram set lan_ipaddr=$lan_pre.$lan_ip
nvram set dhcp_end=$lan_pre.99
#[ "${1::6}" = "Router" ] && nvram set lan_domain=$LAN_DOMAIN

if [ "$1" = "Router" ]; then
	# WAN
	nvram set wan_proto=pppoe
	nvram set wan_pppoe_username=$PPOE_NAME
	nvram set wan_pppoe_passwd=$PPPOE_PASS

	# VTS
	MAPS="HASS,82:89,8  "
	nvram set vts_enable_x=1
	nvram set vts_num_x=`echo "$MAPS" | tr -cd ' ' | wc -c`
	IDX="0"
	for MAP in $MAPS; do
		nvram set vts_proto_x$IDX=TCP
		nvram set vts_desc_x$IDX=`echo $MAP | cut -d , -f 1`
		nvram set vts_port_x$IDX=`echo $MAP | cut -d , -f 2`
		nvram set vts_ipaddr_x$IDX=$lan_pre.`echo $MAP | cut -d , -f 3`
		IDX=`expr $IDX + 1`
	done

	# IPTV
	nvram set udpxy_enable_x=4000
	nvram set vlan_filter=1
	nvram set viptv_mode=2
	nvram set vlan_vid_iptv=9
	nvram set vlan_vid_lan4=9
	nvram set viptv_ipaddr=10.198.137.188
	nvram set viptv_netmask=255.255.192.0
	nvram set viptv_gateway=10.198.128.1
	nvram set udpxy_wopen=1
	nvram set wan_stb_x=4
	nvram set wan_src_phy=0
	nvram set wan_stb_iso=2

	# DDNS
	nvram set ddns_ssl=1
	nvram set ddns_enable_x=1
	nvram set ddns_server_x=DNSPOD.CN
	nvram set ddns_username_x=$DDNS_NAME
	nvram set ddns_passwd_x=$DDNS_PASS
	nvram set ddns_hostname_x=$DDNS_HOST
	nvram set ddns_hostname2_x=$DDNS_HOST2
fi

if [ "$lan_ip" = "1" ] && [ "$1" != "ROUTER" ]; then
	# FW
	nvram set https_wopen=1
	nvram set trmd_ropen=1
	nvram set aria_ropen=1
	nvram set sshd_wopen=1
	nvram set https_wport=81

	# USB
	nvram set enable_samba=1
	nvram set enable_ftp=1
	nvram set trmd_enable=1
	nvram set aria_enable=1
	nvram set acc_username0=admin
	nvram set acc_password0=$ADMIN_PASS
	nvram set acc_num=1
fi

# SYS
nvram set computer_name=`echo ${1::1} | tr  '[a-z]' '[A-Z]'``echo ${1:1} | tr  '[A-Z]' '[a-z]'`
nvram set http_passwd=$ADMIN_PASS
if [ "$1" != "ROUTER" ]; then
	nvram set http_proto=2
	nvram set https_lport=8$lan_ip
fi

nvram commit
#sleep 2
#reboot


rt_sta_crypto=aes
udpxy_wopen=1
vpnc_pdns=0
napt66_enable=0
dr_enable_x=1
rt_IgmpSnEnable=1
sshd_wport=24
ddns2_checkip=0
rt_closed=0
misc_ping_x=0
vlmcsd_enable=0
nf_max_conn=32768
log_ipaddr=
st_samba_lmb=1

achk_enable=1
vpns_ov_mdig=1
rt_wme=0
rt_stream_tx=0
ip6_6rd_size=0
upnp_eport_max=65535
dlna_rescan=0
ddns2_wildcard_x=0
ip6_6to4_relay=192.88.99.1
mentohust_dhcpscript=
sfe_enable=1
wan_src_phy=0
vpns_cast=0
vpns_mru=1450
vpns_ov_port=1194
controlrate_broadcast=90
wan_pppoe_passwd=08065222
vpnc_pppd=
log_port=514
vlan_tag_lan1=0
vlan_tag_lan2=0
fw_dos_x=0
rt_mrate=2
upnp_iport_max=65535
ss_type=0
vpnc_rmsk=
vlan_tag_lan3=0
rt_mode_x=0
vlan_tag_lan4=0
vpns_auth=0
rt_sta_wpa_mode=2
dhcp_dns1_x=
vpns_ov_tcv2=0
mentohust_ip=
crond_log=0
udpxy_renew_period=120
ddns_ipv6=0
wan_pppoe_man=1
scutclient_hash=2ec15ad258aee9604b18f2f8114da38db16efd00
wins_enable=0
wan_nat_x=1
rt_maclist_x=
upnp_enable_x=1
lltd_enable=1
vpnc_enable=0
rt_gmode=5
rt_guest_time_x=00002359
dlna_sort=0
rt_wpa_mode=2
mentohust_dns=
restore_defaults=0
ddns2_user=
force_mld=0
di_time_fail=5
ip6_dns1=
url_inv_x=0
vpnc_ov_atls=0
ip6_dns2=
modem_zcd=0
rt_radio_x=1
hdd_spindt=2
ip6_dns3=
wan_pppoe_service=
filter_lw_time_x=00002359
ttyd_port=7681
dns_forwarder_enable=0
lan_gateway=192.168.2.1
mentohust_timeout=8
mentohust_daemon=1
wan_pppoe_txonly_x=0
rt_guest_time2_x=00002359
di_addr0=114.114.114.114
lan_domain=lan
wan_dns3_x=
rt_HT_AMSDU=0
di_addr1=208.67.222.222
ez_action_long=0
rstats_stored=1
di_addr2=14.17.42.40
modem_type=0
modem_pass=
di_addr3=8.8.8.8
rt_HT_MpduDensity=5
di_addr4=8.8.4.4
vpnc_rnet=
di_addr5=208.67.220.220
dr_staticnum_x=0
wan_pppoe_mru=1492
rt_HT_AutoBA=1
apps_dms=0
hdd_apmoff=0
ether_green=1
acc_username0=admin
wan_gateway=0.0.0.0
dns_forwarder_port=5353
dns_forwarder_server=8.8.4.4:53
lan_dhcpd_x=0
dhcp_start=192.168.1.80
rt_HT_BAWinSize=64
vts_lport_x0=
dr_staticgateway_x=
vpnc_ov_cnat=0
rt_guest_date_x=1111111
dhcp_end=192.168.1.99
nf_alg_pptp=0
wan_ppp_mppe=0
di_time_done=30
dhcp_lease=86400
ddns_period=24
front_led_pwr=1
xTun_dns=1.1.1.1
usb3_disable=0
fw_pt_pppoe=0
xTun_server=server.me
filter_lw_date_x=1111111
url_num_x=0
dhcp_verbose=0
ddns_checkip=0
watchdog_cpu=1
xTun_black_list=/etc/storage/xTun_black_list
stats_server=
rt_radio_time2_x=00002359
ntp_server0=ntp1.aliyun.com
vpns_vuse=0
aria_rport=6800
filter_lw_icmp_x=
ntp_server1=2001:470:0:50::2
xupnpd_udpxy=0
hw_nat_mode=4
vts_srcip_x0=
lan_netmask=255.255.255.0
rt_rts=2347
st_samba_workgroup=WORKGROUP
computer_name=Router
ddns_cst_url=/dyndns/update?system=dyndns&hostname=
nf_alg_ftp0=21
mentohust_mask=
mentohust_dhcp=0
modem_apn=
nf_alg_ftp1=
http_username=admin
sshd_wopen=0
ss_local_port=1080
wan_l2tp_mru=1460
https_clist=DH+AESGCM:DH+AES256:DH+AES:DH+3DES:RSA+AES:RSA+3DES:!ADH:!MD5:!DSS
sh_num=0
dlna_src1=/media/AiDisk_a1
vpns_ov_atls=0
dlna_src2=
dlna_src3=
ss_method=chacha20-ietf-poly1305
di_recon_pause=0
vpnc_ov_ciph=3
rt_guest_closed=0
mentohust_password=
wan_pptp_mru=1400
http_lanport=80
rt_country_code=CN
ddns_cst_svr=members.3322.net
ss_timeout=60
ddns_source=1
rt_key=1
sw_nat_mode=0
wan_netmask=0.0.0.0
rt_macmode=disabled
trmd_rport=9091
ss_key=Secret
macfilter_num_x=0
trmd_enable=1
crond_enable=1
vpns_mtu=1450
wan_hwaddr_x=
rt_auth_mode=psk
aria_pport=16888

rt_guest_wpa_mode=2

scutclient_hostname=Lenovo-PC
vpnc_mppe=0
misc_lpr_x=0
modem_cmd=
udpxy_clients=10
http_passwd=gjzgqz
mr_enable_x=0
sp_battle_ips=0
filter_lw_num_x=0
mentohust_ver=0.00
ss_obfs=plain
wol_mac_last=
ether_flow_lan1=0
xTun_key=password
lan_stp=1
wan_pppoe_demand=0
ether_flow_lan2=0
wan_vci=
rt_HT_EXTCHA=1
rt_wpa_psk=1234567890
ether_flow_lan3=0
rt_bcn=100
fw_lw_enable_x=0
ddns_hostname3_x=
ether_flow_lan4=0
rt_TxBurst=1
dns_forwarder_bind=0.0.0.0
trmd_pport=51413
rt_sta_ssid=
modem_user=
log_float_ui=0
ip6_lan_sfpe=4352
ip6_lan_radv=1
dr_default_x=1
front_led_usb=1
vts_protono_x0=
wan_ppp_auth=0
rt_TxPower=100
ss-tunnel_remote=8.8.4.4:53
stime_stored=1
wan_route_x=IP_Routed
enable_samba=1
ip6_wan_if=0
rt_radius_port=1812
ddns2_server=
dr_staticnetmask_x=0
ss_update_gfwlist=0
lan_hwaddr=00:11:22:33:44:55

modem_nets=0
telnetd=0
vpnc_type=0
vpnc_pass=
vpns_ov_ciph=3
scutclient_password=
wan_dns2_x=
wan_pppoe_mtu=1492
ip6_wan_dhcp=0
dhcp_staticnum_x=0
fn1_action_long=0
rt_wdsnum_x=0
upnp_clean_int=600
mentohust_pinghost=
rt_radius_key=
ip6_lan_sfps=4096
ttyd_enable=0
vpnc_ov_mode=1
ss_enable=0
rt_PktAggregate=1
rt_radius_ipaddr=
vpns_vnet=10.8.0.0
wan_ppp_lcp=1
rt_wep_x=0
ss_obfs_param=
di_lost_action=0
wan_proto=pppoe
https_lport=81
dr_static_matric_x=1
st_max_user=50
ip6_lan_auto=0
sr_num_x=0
vpns_ov_rdgw=0
rt_guest_auth_mode=open
gw_arp_ping=0
wl_country_code=GB
time_zone_x=CST-8
wan_auth_mode=0
ss_server_port=8989
optw_enable=0
aria_ropen=0
ddns_enable_x=1
ss_server=127.0.0.1
fn2_action_long=0

ftpd_wport=21
ss_protocol=origin
modem_dialnum=
lan_dns1=
wan_pppoe_idletime=0
mentohust_enable=0
xTun_iface=tun0
lan_dns2=
vpnc_auth=0
st_ftp_pmin=50000
modem_pin=
force_igmp=0
wan_l2tp_mtu=1460
rt_guest_ap_isolate=1
ip6_sit_mtu=1280
scutclient_enable=0
vlan_pri_lan1=0
ss_router_proxy=1
ddns_forced=10
vlan_pri_lan2=0
nfsd_enable=0
modem_prio=1
vlan_pri_lan3=0
vlan_pri_lan4=0
wan_pptp_mtu=1400
di_timeout=2
nf_nat_type=2
help_enable=1
trmd_ropen=0
sr_rip_x=0
log_level=0
asusddns_tos_agreement=0
wan_hwaddr=00:11:22:33:44:57
ss_udp=0
misc_http_x=0
sr_enable_x=0
modem_isp=
vts_desc_x0=HASS
rt_sta_auth_mode=open
mentohust_datafile=/etc/storage/mentohust/
ss_update_chnroute=0
controlrate_unknown_multicast=0
adsc_enable=0
udpxy_enable_x=4000
rt_preamble=1
mr_qleave_x=1
ip6_lan_dhcp=1
ddns2_hname=
wan_ppp_peer=
rt_guest_lan_isolate=1
mentohust_restart_wait=15
ddns_wildcard_x=0
http_proto=2
ip6_ppe_on=0
nf_alg_h323=0
vpns_ov_mode=1
xTun_cidr=10.0.1.2/24
ss_mtu=1492
rt_mode=ap
st_ftp_pmax=50100
mentohust_maxfail=0
dhcp_dns3_x=
wan_pppoe_username=057101258602

rt_guest_enable=0
ip6_wan_priv=0
rt_KickStaRssiLow=0
st_ftp_mode=2
rt_ssid2=XY-C1_4455
https_wport=81
vpnc_sfw=0
rt_radio_time_x=00002359
ip6_6rd_relay=
fw_mac_drop=0
vpnc_mru=1450
vlan_vid_cpu=
rt_greenap=0
ss-tunnel_mtu=1492
front_led_lan=2
di_lost_delay=1
lan_ipaddr=192.168.1.1
st_samba_fp=1
pcache_reclaim=2
url_enable_x=0
ddns_hostname2_x=guoz.ml
vpnc_user=
vpnc_dgw=0
x_DHCPClient=1
ether_led0=7
controlrate_multicast=0
ether_led1=0
lprd_enable=1
modem_mtu=1500
xTun_port=1082
rt_ssid=XY-C1_4455
rt_dtim=1
mentohust_startmode=1
preferred_lang=CN
wl_txbf_en=0
rt_wdslist_x=
ip6_sit_ttl=64
rt_guest_macrule=0
st_ftp_log=0
dhcp_gateway_x=
ntp_period=24
ether_m2u=2
vts_proto_x0=TCP
wan_ttl_fix=0
rt_crypto=aes
rt_guest_ssid=XY-C1_GUEST_4455

scutclient_skip_udp_hb=0
sshd_enable=1
rt_wpa_gtk_rekey=3600
nvram_manual=0
rt_sta_wpa_psk=
ip6_wan_size=64
upnp_proto=0
mentohust_username=
front_led_wif=1
vpns_num_x=0
rt_mcs_mode=0
ddns_verbose=1
vpnc_peer=

rt_key1=
vpns_ov_compress=2
wan_dns1_x=
rt_key2=
enable_ftp=1
u2ec_enable=1
xupnpd_enable_x=0
vts_ipaddr_x0=192.168.1.8
http_access=0
rt_key3=
rt_key4=
rt_sta_auto=0
modem_dnsa=1
ether_igmp=1
controlrate_unknown_unicast=0
rt_HT_BW=1
rt_radio_date_x=1111111
acc_num=1
nf_nat_loop=1
rt_guest_wpa_psk=
wan_ppp_alcp=0
ss-tunnel_local_port=5301
rt_ap_isolate=0
sw_mode=1
vlan_vid_lan1=
ftpd_wopen=0
xTun_tcp=0
vlan_vid_lan2=
ip6_service=
vpnc_ov_clzo=2
vlan_vid_lan3=
rt_wme_no_ack=off
vlan_vid_lan4=9
vpns_cli0=245
front_led_wan=2
vpns_cli1=254
vpnc_ov_compress=2
wan_ipaddr=0.0.0.0
wan_auth_pass=
dmz_ip=
wan_auth_host=10.0.0.1
http_id=TIDe855a6487043d70a
upnp_clean_min=10
vpnc_ov_ncp_clist=CHACHA20-POLY1305:AES-256-GCM:AES-128-GCM
scutclient_server_auth_ip=202.38.210.131
apps_itunes=0
dhcp_static_arp=0
fn2_action_short=0
wan_ttl_value=0
ip6_dns_auto=0

mlme_radio_rt=1
aria_enable=0
ether_link_wan=0
front_led_all=1
vpnc_ov_prot=0
vpnc_ov_auth=0
lan_dns_x=1
wan_mtu=1500
udpxy_wport=4000
dhcp_static_x=0
ip6_lan_size=64
vpns_actl=0
rt_phrase_x=
st_samba_mode=4
ip6_6rd_dhcp=1
filter_lw_default_x=ACCEPT
console_loglevel=7
rt_stream_rx=0
scutclient_username=
time_zone=CST-8
ss_mode=1
modem_node=0
vts_enable_x=1
https_wopen=1
mentohust_service=0
ss-tunnel_enable=0
vpns_enable=0
fw_enable_x=1
wan_ifname=eth2.2
ether_eee=0
rt_HT_RDG=0
vlan_pri_iptv=0
dlna_root=0
dhcp_dns2_x=
ez_action_short=0
wan_hostname=
ip6_wan_addr=
vts_num_x=1
vpnc_mtu=1450
fw_syn_cook=0
vpns_ov_ncp_clist=CHACHA20-POLY1305:AES-256-GCM:AES-128-GCM
dr_static_rip_x=0
mentohust_nic=
ss_proto_param=
di_port0=53
di_port1=53
rt_channel=0
di_port2=80
vpns_ov_clzo=2
di_poll_mode=0
di_port3=53
di_port4=53
rt_guest_mcs_mode=0
ss_watchcat=1
di_port5=53
rt_wdsapply_x=0
rt_VgaClamp=0
ether_uport=0
rt_key_type=0
rstats_enable=1
nf_alg_rtsp=0
nf_alg_sip=0
mentohust_gw=
mentohust_interval=30
ddns_passwd_x=
modem_rule=0
rt_guest_crypto=aes
macfilter_enable_x=0
rt_sta_wisp=0
ether_jumbo=0
url_time_x=00002359
wan_dnsenable_x=1
vpnc_ov_mdig=1
sshd_wbfp=2
vlan_pri_cpu=0
ddns2_pass=
modem_country=
rt_HT_OpMode=0
vpns_mppe=1
rt_gmode_protection=auto
vpns_ov_prot=0
ddns_hostname_x=guoz.ga
vpnc_ov_port=1194
lan_proto_x=1
wan_auth_user=
fw_log_x=none
wan_pppoe_ac=
rt_AssocReqRssiThres=0
ip6_lan_sflt=1800
ddns_ssl=1
fn1_action_short=0
rawd_enable=0
scutclient_version=4472434f4d0096022a
dhcp_enable_x=1
dlna_disc=895
wan_ppp_pppd=
rt_ldpc=0
st_ftp_anmr=0
misc_httpport_x=8080
acc_password0=gjzgqz
ip6_lan_addr=
scutclient_watchcat=1
ddns2_ssl=1
ether_link_lan1=0
upnp_eport_min=80
scutclient_debug=0
scutclient_wdg_force=1
ether_link_lan2=0
ss_lower_port_only=1
ether_link_lan3=0
dhcp_wins_x=
ether_link_lan4=0
rt_APSDCapable=0
rt_macnum_x=0
dr_staticipaddr_x=
dhcp_dnsv6_x=
ether_flow_wan=0
upnp_secure=1
url_date_x=1111111
vpns_type=0

rt_frag=2346
ip6_6in4_remote=
ip6_wan_gate=
upnp_iport_min=21
url_mac_x=
vts_port_x0=82:89